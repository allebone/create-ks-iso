name: CI Tests using Docker 
on: [push]
jobs:
    test-create-ks-iso:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - name: Build the Docker image
          run: docker build . --file Dockerfile --platform linux/amd64 --tag create-ks-iso:ci-test
        - run: echo "Docker build status is ${{ job.status }}."
        - name: Run create-ks-iso script defaults
          run:  docker run create-ks-iso:ci-test
        - name: Show areas of interest in generated ks.cfg
          run: |
            grep "network --" result/ks.cfg
            grep timezone result/ks.cfg
            grep fips result/ks.cfg | cut -f 1-4 -d ' '
        - name: Run with ksvalidator checks enabled
          run:  docker run --env HOSTNAME --env OSTYPE --env MAJOROSVERSION --env IPADDR --env NETMASK --env GATEWAY --env DNS_SERVERS --env USENTP --env KSVALIDATOR_CHECKS create-ks-iso:ci-test
        - name: Show areas of interest in generated ks.cfg
          run: |
            grep "network --" result/ks.cfg
            grep timezone result/ks.cfg
            grep fips result/ks.cfg | cut -f 1-4 -d ' '
          env:
            HOSTNAME: STIG-RHELv8 
            IPADDR: 192.168.1.2
            NETMASK: 255.255.255.0 
            GATEWAY: 192.168.1.1
            DNS_SERVERS: 192.168.1.1 8.8.8.8 8.8.4.4
            ENABLEFIPS: true
            OSTYPE: RHEL
            MAJOROSVERSION: 8
            USENTP: true
            KSVALIDATOR_CHECKS: true


